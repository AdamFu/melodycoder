!function(e,t){if("object"==typeof exports&&exports)t(exports);else{var n={};t(n),"function"==typeof define&&define.amd?define(n):e.Mustache=n}}(this,function(e){function t(e,t){return b.call(e,t)}function n(e){return!t(m,e)}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e){return String(e).replace(/[&<>"'\/]/g,function(e){return E[e]})}function o(e){this.string=e,this.tail=e,this.pos=0}function s(e,t){this.view=e||{},this.parent=t,this._cache={}}function a(){this.clearCache()}function u(t,n,r,i){for(var o,s,a,l="",c=0,f=t.length;f>c;++c)switch(o=t[c],s=o[1],o[0]){case"#":if(a=r.lookup(s),"object"==typeof a)if(w(a))for(var h=0,p=a.length;p>h;++h)l+=u(o[4],n,r.push(a[h]),i);else a&&(l+=u(o[4],n,r.push(a),i));else if("function"==typeof a){var d=null==i?null:i.slice(o[3],o[5]);a=a.call(r.view,d,function(e){return n.render(e,r)}),null!=a&&(l+=a)}else a&&(l+=u(o[4],n,r,i));break;case"^":a=r.lookup(s),(!a||w(a)&&0===a.length)&&(l+=u(o[4],n,r,i));break;case">":a=n.getPartial(s),"function"==typeof a&&(l+=a(r));break;case"&":a=r.lookup(s),null!=a&&(l+=a);break;case"name":a=r.lookup(s),null!=a&&(l+=e.escape(a));break;case"text":l+=s}return l}function l(e){for(var t,n=[],r=n,i=[],o=0,s=e.length;s>o;++o)switch(t=e[o],t[0]){case"#":case"^":i.push(t),r.push(t),r=t[4]=[];break;case"/":var a=i.pop();a[5]=t[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(t)}return n}function c(e){for(var t,n,r=[],i=0,o=e.length;o>i;++i)t=e[i],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(n=t,r.push(t)));return r}function f(e){return[new RegExp(r(e[0])+"\\s*"),new RegExp("\\s*"+r(e[1]))]}function h(t,i){function s(){if(C&&!k)for(;T.length;)delete S[T.pop()];else T=[];C=!1,k=!1}if(t=t||"",i=i||e.tags,"string"==typeof i&&(i=i.split(d)),2!==i.length)throw new Error("Invalid tags: "+i.join(", "));for(var a,u,h,m,b,x=f(i),w=new o(t),E=[],S=[],T=[],C=!1,k=!1;!w.eos();){if(a=w.pos,h=w.scanUntil(x[0]))for(var N=0,A=h.length;A>N;++N)m=h.charAt(N),n(m)?T.push(S.length):k=!0,S.push(["text",m,a,a+1]),a+=1,"\n"==m&&s();if(!w.scan(x[0]))break;if(C=!0,u=w.scan(y)||"name",w.scan(p),"="===u?(h=w.scanUntil(g),w.scan(g),w.scanUntil(x[1])):"{"===u?(h=w.scanUntil(new RegExp("\\s*"+r("}"+i[1]))),w.scan(v),w.scanUntil(x[1]),u="&"):h=w.scanUntil(x[1]),!w.scan(x[1]))throw new Error("Unclosed tag at "+w.pos);if(b=[u,h,a,w.pos],S.push(b),"#"===u||"^"===u)E.push(b);else if("/"===u){if(0===E.length)throw new Error('Unopened section "'+h+'" at '+a);var O=E.pop();if(O[1]!==h)throw new Error('Unclosed section "'+O[1]+'" at '+a)}else if("name"===u||"{"===u||"&"===u)k=!0;else if("="===u){if(i=h.split(d),2!==i.length)throw new Error("Invalid tags at "+a+": "+i.join(", "));x=f(i)}}var O=E.pop();if(O)throw new Error('Unclosed section "'+O[1]+'" at '+w.pos);return S=c(S),l(S)}var p=/\s*/,d=/\s+/,m=/\S/,g=/\s*=/,v=/\s*\}/,y=/#|\^|\/|>|\{|&|=|!/,b=RegExp.prototype.test,x=Object.prototype.toString,w=Array.isArray||function(e){return"[object Array]"===x.call(e)},E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};o.prototype.eos=function(){return""===this.tail},o.prototype.scan=function(e){var t=this.tail.match(e);return t&&0===t.index?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},o.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return t},s.make=function(e){return e instanceof s?e:new s(e)},s.prototype.push=function(e){return new s(e,this)},s.prototype.lookup=function(e){var t=this._cache[e];if(!t){if("."==e)t=this.view;else for(var n=this;n;){if(e.indexOf(".")>0){t=n.view;for(var r=e.split("."),i=0;t&&i<r.length;)t=t[r[i++]]}else t=n.view[e];if(null!=t)break;n=n.parent}this._cache[e]=t}return"function"==typeof t&&(t=t.call(this.view)),t},a.prototype.clearCache=function(){this._cache={},this._partialCache={}},a.prototype.compile=function(t,n){var r=this._cache[t];if(!r){var i=e.parse(t,n);r=this._cache[t]=this.compileTokens(i,t)}return r},a.prototype.compilePartial=function(e,t,n){var r=this.compile(t,n);return this._partialCache[e]=r,r},a.prototype.getPartial=function(e){return e in this._partialCache||!this._loadPartial||this.compilePartial(e,this._loadPartial(e)),this._partialCache[e]},a.prototype.compileTokens=function(e,t){var n=this;return function(r,i){if(i)if("function"==typeof i)n._loadPartial=i;else for(var o in i)n.compilePartial(o,i[o]);return u(e,n,s.make(r),t)}},a.prototype.render=function(e,t,n){return this.compile(e)(t,n)},e.name="mustache.js",e.version="0.7.2",e.tags=["{{","}}"],e.Scanner=o,e.Context=s,e.Writer=a,e.parse=h,e.escape=i;var S=new a;e.clearCache=function(){return S.clearCache()},e.compile=function(e,t){return S.compile(e,t)},e.compilePartial=function(e,t,n){return S.compilePartial(e,t,n)},e.compileTokens=function(e,t){return S.compileTokens(e,t)},e.render=function(e,t,n){return S.render(e,t,n)},e.to_html=function(t,n,r,i){var o=e.render(t,n,r);return"function"!=typeof i?o:(i(o),void 0)}});