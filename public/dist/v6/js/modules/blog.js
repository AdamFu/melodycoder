define(function(require,exports){var i=require("interface"),Dialog=require("components").dialog,tpl=require("tpl"),commentTPL=new Template(tpl.commentTPL);exports.init=function(){var submitEl=$("respond"),commentList=$("comment-list");if(submitEl.observe("click",function(evt){var This=Element.extend(this),target=Element.extend(evt.target);if("submit"==target.className){var authorEl=This.select(".author")[0],mailEl=This.select(".mail")[0],websideEl=This.select(".webside")[0],commentEl=This.select("textarea")[0];new Ajax.Request(i.ADD_COMMENT,{parameters:"author="+authorEl.value+"&mail="+mailEl.value+"&webside="+websideEl.value+"&comment="+commentEl.value+"&postId="+YYMG.pid,onSuccess:function(r){var r=r.responseText.evalJSON();if(1==r.status.code)if(r.data.isApproved){var date=new Date(r.data.time),m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Spt","Oct","Nov","Dec"],view={pid:YYMG.pid,author:authorEl.value,comment:commentEl.value.escapeHTML(),month:m[date.getMonth()],date:date.getDate(),year:date.getFullYear(),hour:date.getHours(),minute:date.getMinutes()},commentHTML=commentTPL.evaluate(view);commentList?commentList.insert(commentHTML):location.reload()}else new Dialog({showClose:!1,content:"评论成功！需要管理员审核才能显示。"}).addButton("确定",function(){this.close()});else new Dialog({content:r.status.content})},onFailure:function(){new dialog({type:"error",content:""})}})}}),commentList){var commentItemsEl=commentList.select(".comment-item");commentItemsEl.each(function(commentItemEl){commentItemEl.observe("mouseover",function(){var self=Element.extend(this);self.addClassName("item-hover")}),commentItemEl.observe("mouseleave",function(){var self=Element.extend(this);self.removeClassName("item-hover")})})}},exports.listInit=Prototype.emptyFunction});