define(["l/jquery","c/components","c/interface","c/tpl","l/mustache"],function(_,compts,i,tpl,mustache){var Dialog=compts.Dialog,init=function(){var respondFormEl=document.getElementById("respond-form"),submitEl=respondFormEl.submit,authorEl=respondFormEl.author,mailEl=respondFormEl.mail,websideEl=respondFormEl.webside,commentEl=respondFormEl.comment;_(submitEl).bind("click",function(){var verifyMessage,check=function(){return verifyMessage?(new Dialog({type:"error",content:verifyMessage}),!0):!1};0==_.trim(authorEl.value).length&&(verifyMessage="姓名不能为空！",check())||0==_.trim(mailEl.value).length&&(verifyMessage="邮箱地址不能为空！",check())||0==_.trim(commentEl.value).length&&(verifyMessage="评论不能为空！",check())||_.post(i.ADD_COMMENT,_(respondFormEl).serialize()+"&postId="+YYMG.pid,function(){},"json").done(function(r){if(1==r.status.code)if(r.data.isApproved){var date=new Date(r.data.time),m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Spt","Oct","Nov","Dec"],view={pid:YYMG.pid,author:authorEl.value,comment:commentEl.value,month:m[date.getMonth()],date:date.getDate(),year:date.getFullYear(),hour:date.getHours(),minute:date.getMinutes()},targetHTML=mustache.render(tpl.commentTPL,view);_(document.getElementById("comment-list")).append(targetHTML)}else new Dialog({content:"评论成功！需要管理员审核才能显示！"});else new Dialog({type:"error",content:r.status.content})})}),_(respondFormEl).bind("submit",function(){return!1}),_(document.getElementById("comment-list")).delegate(".comment-item","mouseover",function(){_(this).find(".reply-comment").show()}).delegate(".comment-item","mouseout",function(){_(this).find(".reply-comment").hide()}).delegate(".reply-comment a","click",function(){var self=_(this),cmtItemEl=self.parent().parent(),cmtData=cmtItemEl.attr("data-reply");try{cmtData=eval("("+cmtData+")")}catch(e){return new Dialog({type:"error",content:"数据解析错误！"}),void 0}var name=cmtData.name;commentEl.value+="@"+name+" "})};return{init:init}});