define(["l/jquery","c/components","c/interface","c/tpl","l/mustache","c/utils"],function(e,t,n,r,i,o){var s=t.Dialog,a=function(){var t=document.getElementById("respond-form"),a=t.submit,u=t.author,c=t.mail,l=(t.webside,t.comment);e(a).bind("click",function(){var a,f=function(){return a?(new s({type:"error",content:a}),!0):!1},h=e.trim(u.value),p=e.trim(c.value),d=e.trim(l.value);if(0===h.length){if(a="姓名不能为空！",f())return}else if(o.regs.NICKNAME.test(h)||(a="姓名格式不正确！"),f())return;if(0===p.length){if(a="邮箱地址不能为空！",f())return}else if(o.regs.EMAIL.test(p)||(a="邮箱格式不正确！"),f())return;0===d.length&&(a="评论不能为空！",f())||e.post(n.ADD_COMMENT,e(t).serialize()+"&postId="+YYMG.pid,function(){},"json").done(function(t){if(1==t.status.code)if(t.data.isApproved){var n=new Date(t.data.time),o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Spt","Oct","Nov","Dec"],a={pid:YYMG.pid,author:t.data.author,comment:t.data.content,month:o[n.getMonth()],date:n.getDate(),year:n.getFullYear(),hour:n.getHours(),minute:n.getMinutes()},u=i.render(r.commentTPL,a);e(document.getElementById("comment-list")).append(u)}else new s({content:"评论成功！需要管理员审核才能显示！"});else new s({type:"error",content:t.status.content})})}),e(t).bind("submit",function(){return!1}),e(document.getElementById("comment-list")).delegate(".comment-item","mouseover",function(){e(this).find(".reply-comment").show()}).delegate(".comment-item","mouseout",function(){e(this).find(".reply-comment").hide()}).delegate(".reply-comment a","click",function(){var t=e(this),n=t.parent().parent(),r=n.attr("data-reply");try{r=e.parseJSON(r)}catch(i){return new s({type:"error",content:"数据解析错误！"}),void 0}var o=r.name;l.value+="@"+o+" "})};return{init:a}});