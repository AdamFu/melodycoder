define(["l/jquery","c/components","c/interface","c/tpl","l/mustache","c/utils"],function(_,compts,i,tpl,mustache,utils){var Dialog=compts.Dialog,init=function(){var respondFormEl=document.getElementById("respond-form"),submitEl=respondFormEl.submit,authorEl=respondFormEl.author,mailEl=respondFormEl.mail,websideEl=respondFormEl.webside,commentEl=respondFormEl.comment;_(submitEl).bind("click",function(){var e,t=function(){return e?(new Dialog({type:"error",content:e}),!0):!1},n=_.trim(authorEl.value),r=_.trim(mailEl.value),o=_.trim(commentEl.value);if(0===n.length){if(e="姓名不能为空！",t())return}else if(utils.regs.NICKNAME.test(n)||(e="姓名格式不正确！"),t())return;if(0===r.length){if(e="邮箱地址不能为空！",t())return}else if(utils.regs.EMAIL.test(r)||(e="邮箱格式不正确！"),t())return;0===o.length&&(e="评论不能为空！",t())||_.post(i.ADD_COMMENT,_(respondFormEl).serialize()+"&postId="+YYMG.pid,function(){},"json").done(function(e){if(1==e.status.code)if(e.data.isApproved){var t=new Date(e.data.time),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Spt","Oct","Nov","Dec"],r={pid:YYMG.pid,author:e.data.author,comment:e.data.content,month:n[t.getMonth()],date:t.getDate(),year:t.getFullYear(),hour:t.getHours(),minute:t.getMinutes()},i=mustache.render(tpl.commentTPL,r);_(document.getElementById("comment-list")).append(i)}else new Dialog({content:"评论成功！需要管理员审核才能显示！"});else new Dialog({type:"error",content:e.status.content})})}),_(respondFormEl).bind("submit",function(){return!1}),_(document.getElementById("comment-list")).delegate(".comment-item","mouseover",function(){_(this).find(".reply-comment").show()}).delegate(".comment-item","mouseout",function(){_(this).find(".reply-comment").hide()}).delegate(".reply-comment a","click",function(){var self=_(this),cmtItemEl=self.parent().parent(),cmtData=cmtItemEl.attr("data-reply");try{cmtData=eval("("+cmtData+")")}catch(e){return new Dialog({type:"error",content:"数据解析错误！"}),void 0}var name=cmtData.name;commentEl.value+="@"+name+" "})};return{init:init}});